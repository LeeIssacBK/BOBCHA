<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>홈</title>
<!-- jQuery -->
<script src="/resources/js/jquery-3.2.1.min.js"></script>
<!-- 메인 CSS -->
<link rel="stylesheet" type="text/css" href="/resources/css/main.css"></link>
<!-- 부트스트랩 -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
<!--다음 주소 활용 -->
<script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script src="./resources/js/postcode.js"></script>

<!-- NaverMaps API 
<script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=853s8g0fk9&callback=CALLBACK_FUNCTION"></script>
-->

<!-- KakaoMaps API -->
<!-- services와 clusterer, drawing 라이브러리 불러오기 -->
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c77113a5adfb4ed207e26c3c3e09d302&libraries=services,clusterer,drawing"></script>

</head>
<body style="background-color:#a6b9c0; font-family:'Hanna', sans-serif;">
	
	<div>
		<c:choose>
			<c:when test="${sessionScope.m_id eq null}">
			<div style="margin-top:60px;"></div>
			</c:when>
			<c:otherwise>
			<div class="profile" align="center">
				<c:if test="${empty m.m_profile}">
					<img src="/resources/image/profile.jpg" style="border-radius:100px; max-width:30px; max-height:30px; margin-right:10px;">
				</c:if>
				<c:if test="${!empty m.m_profile}">
					<img src="/resources/upload/${m.m_profile}" style="border-radius:100px; max-width:30px; max-height:30px; margin-right:10px;">
				</c:if>
				<b>${m_name} 님</b>
			</div>
			</c:otherwise>
		</c:choose>
				
		<c:choose>
			<c:when test="${sessionScope.m_id eq null}">
				<div class="menu" style="height:200px;">
					<br>
					<a href="" id="home"><img src="/resources/image/home.png" alt="홈" title="홈"/></a><br><br>
					<a href="" id="join"><img src="/resources/image/join.png" alt="회원가입" title="회원가입"/></a><br><br>
					<a href="" id="info"><img src="/resources/image/info.png" alt="문의" title="문의"/></a>
				</div>
			</c:when>
			<c:otherwise>
				<div class="menu">
					<br>
					<a href="" id="home"><img src="/resources/image/home.png" alt="홈" title="홈"/></a><br><br>
					<a href="" id="mypage"><img src="/resources/image/mypage.png" alt="마이페이지" title="마이페이지"/></a><br><br>
					<a href="" id="board"><img src="/resources/image/community.png" alt="자유게시판" title="자유게시판"/></a><br><br>
					<a href="" id="info"><img src="/resources/image/info.png" alt="문의" title="문의"/></a><br><br>
					<a href="" id="logout"><img src="/resources/image/logout.png" alt="로그아웃" title="로그아웃"/></a>
				</div>
			</c:otherwise>
		</c:choose>
	
		<div class="main">
			<!-- 좌측 화면 -->
			<div class="left">
				<img id="logo" src="/resources/image/logo.png" width="100%"/>
				<br><hr>
				<p style="margin-left:26px;">
				<strong>Today : 0</strong>
				</p>
				<div class="border rounded overflow-hidden mb-4 shadow-sm position-relative">
					<div class="col p-4 d-flex flex-column position-static">
						<strong class="d-inline-block mb-2 text-primary">What is BOBCHA?</strong>
						<p class="card-text mb-auto">
						밥차는 좀처럼 만나기 힘든 푸드트럭의 <br>
						위치와 리뷰를 나누는 커뮤니티 웹 어플리케이션 입니다. <br>
						우측의 지도를 통해서 다양한 정보를 유저들과 공유하세요!
						</p>
					</div>
				</div>
				<div class="border rounded overflow-hidden mb-4 shadow-sm position-relative">
					<div class="col p-4 d-flex flex-column position-static">
						<strong class="d-inline-block mb-2 text-primary" style="color:#E28FAD;">Why did you make it?</strong>
						<p class="card-text mb-auto">
							내 집근처에 먹을게 없어요. <br>
							푸드트럭이 언제나타나는지 알수가 없어요. <br>
							가격,운영시간,서비스,평점을 나누고 싶어요. 
						</p>
					</div>
				</div>
				<br>
				
				<br><hr><br>
				<p align="center">Copyright by <b>issac</b></p>
			</div>
			
			<!-- 우측 화면 -->
			<div class="right">
				<div class="right" id="background">
					<div class="showMenu">
						<!-- 네이버지도 API 넣기 
						<div class="location">
							<div id="map" style="width:100%;height:670px;"></div>
						</div>
						-->
						
						<!-- KakaoMap API 넣기 -->
						<div class="location">
							<div id="map" style="width:100%;height:650px;"></div>
							
							<%@ include file="/WEB-INF/views/map/" %>
							<%-- 리뷰 등록 화면 --%>
							<form>
							<div id="reviewMod" style="display:none;"><%-- 상시 감추어 놓음 --%>
								<h4 style="margin-top:10px;">밥차등록</h4>
								<div class="form-group">
									<label for="reviewText">리뷰</label>
									<textarea class="form-control" rows="3" cols="30" id="reviewText"  style="resize:none;"></textarea><%-- 내용이 출력되는 부분 --%>
								</div>
								<div class="form-group">
									<label>가격정보</label>
									<input class="form-control" style="height:30px;" placeholder="1인분에 3000원 / 개당 1000원 과 같이 남겨주세요."/>
								</div>
								<div class="form-group">
									<label>출몰날짜</label>
									<ul class="r_days">
										<li>
											<label for="mon">월</label>
											<input type="checkbox" id="mon" name="day" value="월"/>
										</li>
										<li>
											<label for="tue">화</label>
											<input type="checkbox" id="tue" name="day" value="화"/>
										</li>
										<li>
											<label for="wed">수</label>
											<input type="checkbox" id="wed" name="day" value="수"/>
										</li>
										<li>
											<label for="thu">목</label>
											<input type="checkbox" id="thu" name="day" value="목"/>
										</li>
										<li>
											<label for="fri">금</label>
											<input type="checkbox" id="fri" name="day" value="금"/>
										</li>
										<li>
											<label for="sat">토</label>
											<input type="checkbox" id="sat" name="day" value="토"/>
										</li>
										<li>
											<label for="sun">일</label>
											<input type="checkbox" id="sun" name="day" value="일"/>
										</li>
									</ul>									
								</div>
								<div class="form-group">
									<label>출몰시간</label>
									<select class="form-select" id="r_time" name="r_time" style="width:230px; height:33px; float:right; position:relative;">
										<option value="" selected>밥차의 출몰시간을 알려주세요.</option>
										<option value="00:00 ~ 06:00">00:00 ~ 06:00</option>
										<option value="06:00 ~ 12:00">06:00 ~ 12:00</option>
										<option value="12:00 ~ 18:00">12:00 ~ 18:00</option>
										<option value="18:00 ~ 24:00">18:00 ~ 24:00</option>
									</select>
								</div>
								<div class="review_rating form-group">
									<p style="float:left; margin-top:10px;">평점<p>
									<div class="rating" style="float:right;">
						                <!-- 해당 별점을 클릭하면 해당 별과 그 왼쪽의 모든 별의 체크박스에 checked 적용 -->
						                <input type="checkbox" name="rating" id="rating1" value="1" class="rate_radio" title="1점">
						                <label for="rating1"></label>
						                <input type="checkbox" name="rating" id="rating2" value="2" class="rate_radio" title="2점">
						                <label for="rating2"></label>
						                <input type="checkbox" name="rating" id="rating3" value="3" class="rate_radio" title="3점" >
						                <label for="rating3"></label>
						                <input type="checkbox" name="rating" id="rating4" value="4" class="rate_radio" title="4점">
						                <label for="rating4"></label>
						                <input type="checkbox" name="rating" id="rating5" value="5" class="rate_radio" title="5점">
						                <label for="rating5"></label>
						            </div>
								</div>
								<div class="form-group" style="clear:both;">
					            	<label>가게사진</label>
					            	<div class="filebox">
						            	<div>
						            		<input id="bob_pic" class="form-control" readonly placeholder="이미지 파일만 업로드 해주세요." style="width:277px; height:30px;display:inline;"/>
						            		<label for="file" style="float:right; position:relative; text-align:center; width:60px; height:30px;">첨부</label>
						            		<input type="file" id="file" name="bob_pic" accept="image/jpeg, image/jpg, image/png" multiple/>
						            	</div>
					            	</div>
					            </div>
								<div class="form-group" style="float:right; margin-top:30px;">
									<button type="button" id="reviewSubBtn" class="btn btn-primary" style="width:60px; height:30px; font-size:13px;" >등록</button>
									<button type="button" id="reviewCloseBtn" class="btn btn-primary"  style="width:60px; height:30px; font-size:13px;" onclick="reviewClose();">취소</button>
								</div>
							</div>
							</form>
							
								<script>
									var container = document.getElementById('map');
									var options = {
										center: new kakao.maps.LatLng(33.450701, 126.570667),
										level: 3
									};
									var map = new kakao.maps.Map(container, options);
	
									// 주소-좌표 변환 객체를 생성합니다
									var geocoder = new kakao.maps.services.Geocoder();
	
									// 회원의 주소지를 가져옴.
									var myAddr = '${m.m_addr_1}';
	
									// 주소로 좌표를 검색합니다
									geocoder.addressSearch(myAddr, function(result, status) {
	
									// 정상적으로 검색이 완료됐으면 
									if (status === kakao.maps.services.Status.OK) {
										var coords = new kakao.maps.LatLng(result[0].y, result[0].x);
										// 결과값으로 받은 위치를 마커로 표시합니다
										var marker = new kakao.maps.Marker({
											map: map,
											position: coords
										});
									// 인포윈도우로 장소에 대한 설명을 표시합니다
									var infowindow = new kakao.maps.InfoWindow({
										content: '<div style="width:150px;text-align:center;padding:6px 0;">${m.m_name}님의 주변에 밥차를 등록해 보세요!</div>'
									});
									infowindow.open(map, marker);
									// 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
									map.setCenter(coords);
										} 
									}); 
									
									// 지도에 클릭 이벤트를 등록합니다
									// 지도를 클릭하면 마지막 파라미터로 넘어온 함수를 호출합니다
									kakao.maps.event.addListener(map, 'click', function(mouseEvent) {        
									    
									    // 클릭한 위도, 경도 정보를 가져옵니다 
									    var latlng = mouseEvent.latLng;
									    var marker = new kakao.maps.Marker({
									    	position:latlng
									    });
									    marker.setMap(map);
									    
									    if (confirm('이곳에 밥차를 등록하시겠습니까?') == true){
						          			$('#reviewMod').show();
									    }else{
									    	//마커를 표시하지 않음
									    	marker.setMap(0);
									    }
									});
									
					          		//모달화면 닫기
					          		function reviewClose(){
					          			$('#reviewMod').hide();
					          		}
									
								</script>
								
							</div>
						</div>
				</div>
			</div>
			
		</div>
	</div>
	
<!-- <script src="/resources/js/naver_map.js"></script>-->
	
	<!-- 메뉴페이지 이동소스 -->
	<script>
		$(document).ready(function(){
						
			//홈화면
			$('#home').click(function(){
				location.href('/');
				return false;
			});
			
			//회원가입1
			$('#join').click(function(){
				$('.showMenu').empty();
				$('.showMenu').load('/member/userJoin');
				return false;
			});
			
			//로그인
			$('#login').click(function(){
				$('.showMenu').empty();
				$('.showMenu').load('/member/userLogin');
				return false;
			});
			
			//마이페이지
			$('#mypage').click(function(){
				$('.showMenu').empty();
				$('.showMenu').load('/mypage/mypage');
				return false;
			});
			
			//게시판
			$('#board').click(function(){
				$('.showMenu').empty();
				$('.showMenu').load('/board/board');
				return false;
			});
			
			//인포
			$('#info').click(function(){
				$('.showMenu').empty();
				$('.showMenu').load('/info/info');
				return false;
			});
			
			//로그아웃
			$('#logout').click(function(){
				$('.showMenu').empty();
				$('.showMenu').load('/logout');
				return false;
			});
			
			//페이지 get방식 확인후 넘겨줌
			function Request(valuename){
				var rtnval = "";
				var nowAddress = unescape(location.href);
				var parameters = (nowAddress.slice(nowAddress.indexOf("?")+1,nowAddress.length)).split("&");
				for(var i = 0 ; i < parameters.length ; i++){
					var varName = parameters[i].split("=")[0];
					if(varName.toUpperCase() == valuename.toUpperCase()){
						rtnval = parameters[i].split("=")[1];
						break;
					}
				}
				return rtnval;
			}
			var value = Request("pv");
			if(value == 'board'){
				history.replaceState({}, null, location.pathname);
				$('.showMenu').empty();
				$('.showMenu').load('/board/board');
				return false;
			}
			if(value == 'mypage'){
				history.replaceState({}, null, location.pathname);
				$('.showMenu').empty();
				$('.showMenu').load('/mypage/mypage');
				return false;
			}
			//세션값 확인
			var session = '${sessionScope.m_id}';
			
			if(session == ""){
				$('.showMenu').empty();
				$('.showMenu').load('/member/userLogin');
			}
			
		});
	</script>
	
	<script>
		//별평점주기
		//별점 마킹 모듈 프로토타입으로 생성
		function Rating(){};
		Rating.prototype.rate = 0;
		Rating.prototype.setRate = function(newrate){
		    //별점 마킹 - 클릭한 별 이하 모든 별 체크 처리
		    this.rate = newrate;
		    let items = document.querySelectorAll('.rate_radio');
		    items.forEach(function(item, idx){
		        if(idx < newrate){
		            item.checked = true;
		        }else{
		            item.checked = false;
		        }
		    });
		}
		let rating = new Rating();//별점 인스턴스 생성
		
		document.addEventListener('DOMContentLoaded', function(){
		    //별점선택 이벤트 리스너
		    document.querySelector('.rating').addEventListener('click',function(e){
		        let elem = e.target;
		        if(elem.classList.contains('rate_radio')){
		            rating.setRate(parseInt(elem.value));
		        }
		    })
		});
	</script>
	

</body>
</html>